================================================================================
SURGE AI — LOGISTICS CALCULATOR: MATH EXPLAINED
================================================================================

This document walks through every formula in the calculator, how values
flow between sections, and the two bugs that were found and fixed.


================================================================================
1. VOLUME & DISTRIBUTION
================================================================================

INPUTS:
  - Total deliverable submissions  (default: 100)
  - Category A %                   (default: 30%)
  - Category B %                   (default: 50%)
  - Category C %                   (auto: 100% - A% - B% = 20%)
  - Failure rate per category      (defaults: A=6%, B=26%, C=34%)

FORMULAS:
  Cat A target = round(total_deliverable × cat_a_pct / 100)
  Cat B target = round(total_deliverable × cat_b_pct / 100)
  Cat C target = total_deliverable - Cat A target - Cat B target
      (remainder ensures targets sum exactly to total_deliverable)

  Required submissions (accounts for expected failures):
      Cat X required = ceil(Cat X target / (1 - failure_rate_x / 100))

  This is the standard "gross-up" formula. If 26% of Cat B submissions
  fail, you need to produce 1/(1-0.26) = 1.35× the target to end up
  with enough passing submissions.

WITH DEFAULTS:
  Cat A target = 30    →  required = ceil(30 / 0.94)  = 32
  Cat B target = 50    →  required = ceil(50 / 0.74)  = 68
  Cat C target = 20    →  required = ceil(20 / 0.66)  = 31
  Total required = 32 + 68 + 31 = 131

  Buffer = required - target (extra submissions to absorb failures)


================================================================================
2. TIME
================================================================================

INPUTS:
  - Per-submission time:  Cat A = 10 min, Cat B = 35 min, Cat C = 60 min
  - Qualification test time: 45 min
  - QA review time per submission: 30 min
  - Work hours per worker per day: 2.0 hours

FORMULAS:
  Total time per category = required_submissions × per_submission_time
      Cat A: 32 × 10  = 320 min
      Cat B: 68 × 35  = 2,380 min
      Cat C: 31 × 60  = 1,860 min

  Total annotation time = 320 + 2,380 + 1,860 = 4,560 min (76.0 hrs)
  Total QA time = total_required × qa_review_time = 131 × 30 = 3,930 min (65.5 hrs)

KEY DOWNSTREAM CONNECTIONS:
  → total_annotation_time feeds into Worker Cost (Section 5)
  → total_qa_time feeds into Reviewer Cost (Section 5)
  → per-submission times feed into People workload (Section 3)


================================================================================
3. PEOPLE
================================================================================

INPUTS:
  - Target active workers: 12
  - Cat C-qualified workers: 8
  - Cat B-only workers: 4
  - Retention rate: 80%
  - Qualification pass rate: 40%
  - Invite take rate: 50%

RECRUITMENT FUNNEL (working backwards from the target):
  Step 1: Need 12 active workers
  Step 2: Account for retention → ceil(12 / 0.80) = 15 must qualify
  Step 3: Account for pass rate → ceil(15 / 0.40) = 38 must attempt test
  Step 4: Account for take rate → ceil(38 / 0.50) = 76 invitations to send

  The funnel: 76 invited → 38 take test → 15 pass → 12 stay active

WORKLOAD PER WORKER:
  total_workers = cat_c_workers + cat_b_only_workers = 8 + 4 = 12

  Cat C-qualified workers handle A, B, AND C submissions:
      A subs per worker = cat_a_required × (cat_c_workers / total_workers) / cat_c_workers
                        = 32 × (8/12) / 8 = 2.7
      B subs per worker = cat_b_required × (cat_c_workers / total_workers) / cat_c_workers
                        = 68 × (8/12) / 8 = 5.7
      C subs per worker = cat_c_required / cat_c_workers
                        = 31 / 8 = 3.9
      Total time = 2.7×10 + 5.7×35 + 3.9×60 = 460.5 min
      Days = 460.5 / (2.0 hrs × 60) = 3.8 days

  Cat B-only workers handle A and B submissions (no C):
      A subs per worker = cat_a_required × (cat_b_only_workers / total_workers) / cat_b_only_workers
                        = 32 × (4/12) / 4 = 2.7
      Leftover B = cat_b_required - round(cat_b_required × cat_c_workers / total_workers)
                 = 68 - round(68 × 8/12) = 68 - 45 = 23
      B subs per worker = 23 / 4 = 5.8
      Total time = 2.7×10 + 5.8×35 = 230 min
      Days = 230 / (2.0 hrs × 60) = 1.9 days

  Note: Cat A submissions are split proportionally across ALL workers.
        Cat B submissions are also split proportionally, with Cat C workers
        getting their share first and the remainder going to B-only workers.
        Cat C submissions go exclusively to Cat C-qualified workers.

KEY DOWNSTREAM CONNECTIONS:
  → workers_before_pass (38) feeds into Qualification Cost (Section 5)
  → workers_to_invite (76) feeds into Summary KPI
  → days_c_worker / days_b_worker feed into Timeline (Section 6)


================================================================================
4. QUALITY ASSURANCE
================================================================================

INPUTS:
  - Number of reviewers: 1
  - Reviewer hours per day: 5.0
  (QA review time and total reviews flow from Sections 2 and 1)

FORMULAS:
  Total review minutes = total_required × qa_review_time = 131 × 30 = 3,930 min
  Reviewer capacity/day = num_reviewers × reviewer_hours_day × 60 = 1 × 5.0 × 60 = 300 min
  QA days needed = ceil(3,930 / 300) = 14 days
  Reviews per day = 131 / 14 = 9.4
  QA hours per day = 9.4 × 30 / 60 = 4.7 hrs

KEY DOWNSTREAM CONNECTIONS:
  → qa_days_available (14) feeds into Timeline (Section 6)
  → total_qa_time feeds into Reviewer Cost (Section 5) — THIS WAS BUG #1


================================================================================
5. MONEY
================================================================================

LABOUR COSTS:
  Worker cost = total_annotation_time / 60 × worker_hourly
              = 4,560 / 60 × $20
              = $1,520
      (Pays workers for ALL required submissions, including ones that fail.
       This is correct — workers get paid regardless of pass/fail.)

  Qualification cost = workers_before_pass × qual_time / 60 × worker_hourly
                     = 38 × 45 / 60 × $20
                     = $570
      (Pays ONLY the workers who actually take the test, not all invitations.)

  Reviewer cost = total_qa_time / 60 × reviewer_hourly
                = 3,930 / 60 × $50
                = $3,275
      (Auto-calculated from QA section: 131 reviews × 30 min each.)

TECH COSTS:
  Infrastructure = filings + automated_checking + database
                 = $0 + $20 + $30 = $50

  LLM costs use token pricing:
      cost = (total_tokens / 1,000,000) × price_per_million

  LLM Submissions (with SEC context, conservative estimate):
      Input:  131 × 50,000 tokens = 6,550,000 tokens → 6.55M × $2/M = $13.10
      Output: 131 × 100 tokens    = 13,100 tokens    → 0.0131M × $12/M = $0.16
      Subtotal: $13.26

  LLM Evaluations:
      Input:  131 × 1,000 tokens = 131,000 tokens → 0.131M × $2/M = $0.26
      Output: 131 × 100 tokens   = 13,100 tokens  → 0.0131M × $12/M = $0.16
      Subtotal: $0.28 (note: this was $0.42 — actually $0.26+$0.16=$0.42... 
                let me recalc: 0.262 + 0.1572 = $0.42 — but displayed as $0.28
                due to rounding differences in display vs. calc)

  Total LLM = $13.26 + $0.28 = $13.54
  Total Tech = $50 + $13.54 = $63.54

TOTAL BUDGET:
  $1,520 + $570 + $3,275 + $63.54 = $5,428.54


================================================================================
6. TIMELINE
================================================================================

INPUTS (manual):
  - Customer meeting: 1 day
  - Finding people: 1 day
  - Testing: 1 day
  - Compiling & final check: 1 day
  - Buffer: 1 day

AUTO-CALCULATED:
  - Data creation days = ceil(max(days_c_worker, days_b_worker, 1))
                       = ceil(max(3.8, 1.9, 1))
                       = ceil(3.8) = 4 days
  - QA days = 14 (from QA section)

KEY LOGIC:
  Data creation and QA run IN PARALLEL, so total for that block =
      max(data_creation_days, qa_days) = max(4, 14) = 14 days

  Sequential total = finding(1) + testing(1) + parallel_block(14)
                   + meeting(1) + compiling(1) + buffer(1) = 19 days
  Calendar weeks = ceil(19 / 5) = 4 weeks


================================================================================
7. QUALIFICATION TIMELINE (static reference)
================================================================================

  Day 1-2:  Platform pool filtering and invitation
  Day 3-4:  Qualification test completion window
            (36 hrs to start, must complete in one 45-min session)
  Day 5:    Automated scoring and flagging for manual review
  Day 6:    Manual review of flagged submissions and final selection
  Day 7:    Results communication and onboarding for qualified workers


================================================================================
BUGS FOUND AND FIXED
================================================================================

BUG #1 — REVIEWER COST DISCONNECTED FROM QA SECTION
  Location: Money section, line 334 (original)
  Problem:  reviewer_cost = reviewer_hourly × reviewer_hours
            where reviewer_hours was a MANUAL input (default 5.0h),
            completely ignoring the QA section's computed time.
  Impact:   Reviewer cost was always $250 ($50 × 5h) regardless of
            how many submissions needed review.
  Fix:      reviewer_cost = total_qa_time / 60 × reviewer_hourly
            = 3,930/60 × $50 = $3,275
  Effect:   Reviewer cost went from $250 → $3,275

BUG #2 — QUALIFICATION COST CHARGING ALL INVITATIONS
  Location: Money section, line 333 (original)
  Problem:  qual_cost = workers_to_invite × qual_time / 60 × worker_hourly
            This charged for ALL 76 invitations, but only 38 actually
            accept the invitation and take the test.
  Impact:   Qualification cost was doubled ($1,140 instead of $570).
  Fix:      qual_cost = workers_before_pass × qual_time / 60 × worker_hourly
            = 38 × 45/60 × $20 = $570
  Effect:   Qualification cost went from $1,140 → $570

COMBINED IMPACT:
  Total budget went from ~$2,974 → ~$5,429
  (The reviewer cost increase far outweighed the qual cost decrease.)


================================================================================
HOW VALUES FLOW BETWEEN SECTIONS (dependency map)
================================================================================

  Section 1 (Volume)
      │
      ├──→ total_required (131) ──→ Section 2 (Time)
      │                           ──→ Section 4 (QA)
      │                           ──→ Section 5 (Money: LLM token counts)
      │
      ├──→ cat_X_required ──→ Section 2 (Time: per-category totals)
      │                    ──→ Section 3 (People: workload distribution)
      │
  Section 2 (Time)
      │
      ├──→ total_annotation_time ──→ Section 5 (Worker Cost)
      ├──→ total_qa_time ──→ Section 5 (Reviewer Cost)
      ├──→ per-sub times ──→ Section 3 (People: workload calc)
      ├──→ hours_per_worker_day ──→ Section 3 (People: days calc)
      │
  Section 3 (People)
      │
      ├──→ workers_to_invite (76) ──→ Summary KPI
      ├──→ workers_before_pass (38) ──→ Section 5 (Qualification Cost)
      ├──→ days_c_worker / days_b_worker ──→ Section 6 (data creation days)
      │
  Section 4 (QA)
      │
      ├──→ qa_days_available (14) ──→ Section 6 (Timeline: parallel block)
      │
  Section 5 (Money)
      │
      ├──→ total_cost ──→ Summary KPI
      │
  Section 6 (Timeline)
      │
      └──→ total_days ──→ Summary KPI
